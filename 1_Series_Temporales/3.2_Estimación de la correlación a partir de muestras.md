**Problema:** La función de [[3_Medidas de dependencia#Autocorrelación de una 2_Series Temporales serie temporal|autocorrelación]] está bien definida, pero si no tenemos el modelo debemos estimarla a partir de observaciones.

**Desafío:** en el caso de variables $iid$ promediando podíamos hallar media y varianza. El problema aquí es que en general disponemos de una única realización de la [[1_Series_Temporales/2_Series Temporales.md|serie de tiempo]]!

**Idea:** En el caso de [[1_Series_Temporales/3.1_Procesos estacionarios.md|series estacionarias]], podemos utilizar las propias muestras, ya que las características de la serie no cambian con el tiempo.

## Estimador de la media:
Sea $x_t$ un proceso estacionario. Se tiene el siguiente estimador para la media $\mu$:
$$\bar{x} = \frac{1}{n} \sum_{t=1}^n x_t$$

La varianza de este estimador se puede calcular a partir de la correlación del proceso:
$$\textrm{Var}(\bar{x}) = \frac{1}{n} \sum_{h=-n}^n \left(1-\frac{|h|}{n}\right)\gamma(h).$$

## Estimador de la autocorrelación:
La *autocovarianza muestral* de una realización $\{x_t\}$ de una serie de tiempo estacionaria se define como:
$$ \hat{\gamma}(h) = \frac{1}{n} \sum_{t=1}^{n-h}(x_{t+h}-\bar{x})(x_t-\bar{x}).$$
con $\hat{\gamma}(-h) = \hat{\gamma}(h)$ y $h=0,1\ldots,n-1$.

La *autocorrelación muestral* se define como:
$$\hat{\rho}(h) = \frac{\hat{\gamma}(h)}{\hat{\gamma}(0)}.$$

## Propiedad (distribución asintótica de la ACF)
Si el proceso es ruido blanco (con momentos finitos, en particular ruido blanco gaussiano), entonces para una muestra grande ($n\to\infty$), la estimación anterior de la ACF es asintóticamente gaussiana con desvío:
$$\sigma_{\rho(h)} = \frac{1}{\sqrt{n}}.$$

* Otra forma de verlo: si es ruido blanco, 95% de las autocorrelaciones ($h>0$) estimadas caen a $\pm \frac{2}{\sqrt{n}}$ de $0$. Entonces si una medida de autocorrelación cae fuera de este intervalo es porque no proviene de ruido blanco. 
* Dicho de otro modo, si uno "blanquea" la señal (se queda solo con la parte de ruido), tenemos un test para chequear que lo que obtuvimos sea ruido blanco.

### Ejemplo: ruido blanco
```python
w = np.random.normal(size=2000)
sm.graphics.tsa.plot_acf(w);
```
![[Pasted image 20250414034604.png]]

### Ejemplo: media móvil
Consideremos el proceso:
$$x_t = \frac{1}{3}\left(w_t+w_{t-1}+w_{t-2}\right)$$

cuya autocorrelación calculamos teóricamente en [[3_Medidas de dependencia#Autocorrelación de una 2_Series Temporales serie temporal|autocorrelación de una serie temporal]].
$$\rho(s,t) = \left\{\begin{array}{ll} 1/3 & s=t-2 \\
2/3 & s=t-1 \\
1 & s=t \\
2/3 & s=t+1 \\
1/3 & s=t+2 \\
0 & \text{en otro caso} \end{array}\right..$$

```python
x = sp.signal.lfilter([1/3,1/3,1/3],[1],w)
sm.graphics.tsa.plot_acf(x);
```
![[Pasted image 20250414034835.png]]

### Ejemplo: proceso autorregresivo
Consideremos el proceso:
$$x_t = 0.8 x_{t-1} + w_t$$
siendo $w_t$ ruido blanco gaussiano de varianza $\sigma_w^2=1$.

**Simulación**
```python
x = sp.signal.lfilter([1.0],[1,-.8],w)
plt.plot(x);
```
![[Pasted image 20250414034920.png]]

**Función de autocorrelación**
Estimemos la autocorrelación: en un proceso de este tipo, la ACF decae exponencialmente, ya que cada valor depende del anterior, que a su vez depende del anterior, etc. La memoria se va perdiendo con el tiempo.
```python
sm.graphics.tsa.plot_acf(x);
```
![[Pasted image 20250414035122.png]]


### Correlograma con lags
Otra forma de entender lo anterior es graficar las parejas $(x_{t-h},x_t)$ en el plano, para diferentes valores del "lag" $h$. Básicamente la autocorrelación de lag $h$, $\hat{\rho}(h)$ es el coeficiente de correlación entre las variables $x_t$ y $x_{t-h}$.

```python
plt.figure(figsize=(10,10))
for i in range(1,9):
    plt.subplot(4,4,i)
    plt.scatter(x,sp.ndimage.shift(x,i));
    plt.title(f"Lag {i}")
```
![[Pasted image 20250414035206.png]]
Vemos como la autocorrelación va disminuyendo a medida que aumentamos el $h$.